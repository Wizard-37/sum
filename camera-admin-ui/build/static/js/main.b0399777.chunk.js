(this["webpackJsonpcamera-admin-ui"]=this["webpackJsonpcamera-admin-ui"]||[]).push([[0],{186:function(e,t,a){},188:function(e,t,a){},338:function(e,t,a){},339:function(e,t,a){"use strict";a.r(t);var n=a(6),c=a(0),s=a.n(c),r=a(26),i=a.n(r),l=(a(186),a(187),a(19)),o=a(47),f=a.n(o),d=a(68),h=a(150),m=a(48),u=a(119),j=a(179),g=a(175),b=(a(188),a(86)),v=a(344),O=a(71),x=a(87),p=a(161),C=a(346),y=a(343),S=a(345),k=a(189);function w(e){return T.apply(this,arguments)}function T(){return(T=Object(d.a)(f.a.mark((function e(t){var a,n,c,s,r=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.length>1&&void 0!==r[1]?r[1]:"GET",n=r.length>2?r[2]:void 0,c="".concat("").concat(t),e.next=5,k({url:c,method:a,headers:n,transformResponse:function(e){return e},withCredentials:!0,timeout:4900});case 5:return s=e.sent,e.abrupt("return",s.data);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return A.apply(this,arguments)}function A(){return(A=Object(d.a)(f.a.mark((function e(t){var a,n,c,s,r=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.length>1&&void 0!==r[1]?r[1]:"POST",n=r.length>2?r[2]:void 0,c=r.length>3?r[3]:void 0,e.next=5,k({url:"".concat("").concat(t),method:a,data:n,transformResponse:function(e){return e},headers:c||{"Content-Type":"application/json"},withCredentials:!0,timeout:4900});case 5:return s=e.sent,e.abrupt("return",s.data);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=b.a.Option,D=function(e){Object(j.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={loading:!0,config:null,error:null,status:null,newCamera:{},ffmpeg:{},ffmpegPre:{}},n.save=n.save.bind(Object(m.a)(n)),n.handleMainTransportChange=n.handleMainTransportChange.bind(Object(m.a)(n)),n.handleCameraChange=n.handleCameraChange.bind(Object(m.a)(n)),n.cameraDatasource=n.cameraDatasource.bind(Object(m.a)(n)),n.cameraColumns=n.cameraColumns.bind(Object(m.a)(n)),n.saveActiveChannel=n.saveActiveChannel.bind(Object(m.a)(n)),n.addDatasource=n.addDatasource.bind(Object(m.a)(n)),n.commonColumns=n.commonColumns.bind(Object(m.a)(n)),n}return Object(u.a)(a,[{key:"save",value:function(){var e=Object(d.a)(f.a.mark((function e(){var t,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.prev=1,t=JSON.stringify(this.state.config.config),e.next=5,P("/admin/config/save","POST",t);case 5:a=e.sent,this.setState({config:JSON.parse(a)}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),this.setState({error:e.t0.message});case 12:return e.prev=12,this.setState({loading:!1}),e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[1,9,12,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"saveActiveChannel",value:function(){var e=Object(d.a)(f.a.mark((function e(){var t,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.prev=1,t=JSON.stringify(this.state.status),e.next=5,P("/admin/status/save","POST",t);case 5:a=e.sent,this.setState({status:JSON.parse(a)}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),this.setState({error:e.t0.message});case 12:return e.prev=12,this.setState({loading:!1}),e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[1,9,12,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"commonColumns",value:function(){var e=this;return[{title:"Parameter Name",dataIndex:"name",key:"name",render:function(e){return Object(n.jsx)("a",{children:e})}},{title:"Parameter Value",dataIndex:"value",key:"value",render:function(t,a){if("1"===a.key)return Object(n.jsx)("div",{children:Object(n.jsxs)(b.a,{defaultValue:t,style:{width:120},onChange:e.handleMainTransportChange,children:[Object(n.jsx)(I,{value:"udp",children:"UDP"}),Object(n.jsx)(I,{value:"tcp",children:"TCP"})]})});if("2"===a.key||"3"===a.key){var c="3"===a.key?"ffmpeg":"ffmpegPre";return Object(n.jsx)("div",{children:Object(n.jsxs)("div",{children:[e.state.config.config[c]?Object.entries(e.state.config.config[c]).map((function(t,a){var s=t[0],r=t[1];return Object(n.jsxs)("div",{children:[Object(n.jsx)(v.a.Text,{disabled:!0,children:s}),Object(n.jsx)(v.a.Text,{disabled:!0,children:":"}),Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){var a=Object(l.a)({},e.state.config);a.config[c]||(a.config[c]={}),a.config[c][s]=t,e.save().then(),e.setState({config:a})}},children:r}),Object(n.jsx)(O.a,{size:"small",type:"danger",className:"smallButton",onClick:function(){var t=Object(l.a)({},e.state.config);t.config[c]||(t.config[c]={}),delete t.config[c][s],e.setState({config:t}),e.save().then()},children:"-"})]})})):Object(n.jsx)("div",{}),Object(n.jsxs)("div",{children:[Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){var a=Object(l.a)({},e.state[c]);a.key=t,a.itemKey=-1;var n={};n[c]=a,e.setState(n)}},children:e.state[c]&&-1===e.state[c].itemKey?e.state[c].key:""}),Object(n.jsx)(v.a.Text,{disabled:!0,children:":"}),Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){var a=Object(l.a)({},e.state[c]);a.value=t,a.valueItem=-1;var n={};n[c]=a,e.setState(n)}},children:e.state[c]&&-1===e.state[c].valueItem?e.state[c].value:""}),-1===e.state[c].valueItem&&-1===e.state[c].itemKey?Object(n.jsx)(O.a,{onClick:function(){var t=Object(l.a)({},e.state[c]),a=Object(l.a)({},e.state.config);a.config[c]||(a.config[c]={}),a.config[c][t.key]=t.value,e.setState({config:a}),e.save().then((function(){var t={};t[c]={},e.setState(t)}))},children:"Add"}):Object(n.jsx)(O.a,{disabled:!0,children:"Add"})]})]})})}return"4"===a.key?Object(n.jsx)("div",{children:Object(n.jsx)(x.a,{checked:!!e.state.config.config.killAll,onChange:function(t){var a=Object(l.a)({},e.state.config);a.config.killAll=t.target.checked,e.setState({config:a}),e.save().then()}})}):Object(n.jsx)("a",{children:t})}}]}},{key:"addColumns",value:function(){var e=this;return[{title:"Mode",dataIndex:"mode",key:"mode",render:function(t){return Object(n.jsx)("div",{children:Object(n.jsxs)(b.a,{defaultValue:t,style:{width:120},onChange:e.handleCameraChange,children:[Object(n.jsx)(I,{value:"single",children:"1 Camera"}),Object(n.jsx)(I,{value:"multi",children:"4 Cameras"})]})})}},{title:"rtsp Streams",dataIndex:"rtsp",key:"rtsp",render:function(){return"multi"===e.state.newCamera.mode?Object(n.jsxs)("div",{children:[Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){var a=Object(l.a)({},e.state.newCamera);a.camera1=t,e.setState({newCamera:a})}},children:e.state.newCamera.camera1||""}),Object(n.jsx)("br",{}),Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){var a=Object(l.a)({},e.state.newCamera);a.camera2=t,e.setState({newCamera:a})}},children:e.state.newCamera.camera2||""}),Object(n.jsx)("br",{}),Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){var a=Object(l.a)({},e.state.newCamera);a.camera3=t,e.setState({newCamera:a})}},children:e.state.newCamera.camera3||""}),Object(n.jsx)("br",{}),Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){var a=Object(l.a)({},e.state.newCamera);a.camera4=t,e.setState({newCamera:a})}},children:e.state.newCamera.camera4||""}),Object(n.jsx)("br",{})]}):Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){var a=Object(l.a)({},e.state.newCamera);a.camera1=t,e.setState({newCamera:a})}},children:e.state.newCamera.camera1||""})}},{title:"",dataIndex:"save",key:"save",render:function(){var t=e.state.newCamera.mode||"single",a=!1;return"single"!==t||e.state.newCamera.camera1||(a=!0),"multi"!==t||e.state.newCamera.camera1&&e.state.newCamera.camera2&&e.state.newCamera.camera3&&e.state.newCamera.camera4||(a=!0),a?Object(n.jsx)("div",{children:Object(n.jsx)(O.a,{disabled:!0,children:"Save"})}):Object(n.jsx)("div",{children:Object(n.jsx)(O.a,{onClick:function(){var a,n=Object(l.a)({},e.state.config);a="single"===t?{streamUrl:e.state.newCamera.camera1}:{streamUrl:[e.state.newCamera.camera1,e.state.newCamera.camera2,e.state.newCamera.camera3,e.state.newCamera.camera4]},n.config.channels.push(a),e.setState({config:n}),e.save().then((function(){e.setState({newCamera:{}})}))},children:"Save"})})}}]}},{key:"addDatasource",value:function(){var e=this.state.newCamera;return[{mode:e.mode||"single",rtsp:[e.camera1,e.camera2,e.camera3,e.camera4]}]}},{key:"cameraColumns",value:function(){var e=this;return[{title:"Status",dataIndex:"status",key:"status",render:function(t,a,c){return t?Object(n.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:"/camera.html",children:"Current"}):Object(n.jsx)(O.a,{onClick:function(){e.state.status.currentChannel=c,e.saveActiveChannel().then()},children:"Activate"})}},{title:"Camera",dataIndex:"camera",key:"camera",render:function(e){return Object(n.jsx)("a",{children:e})}},{title:"Camera Mode",dataIndex:"mode",key:"mode",render:function(e){return Object(n.jsx)("a",{children:1===e?"1 Camera":"4 Cameras"})}},{title:"rtsp Streams",dataIndex:"rtsp",key:"rtsp",render:function(t,a,c){return t?Array.isArray(t)?t.length>1?t.map((function(t,a){return Object(n.jsxs)("div",{children:[Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){e.state.config.config.channels[c].streamUrl[a]=t,e.save().then()}},children:t}),Object(n.jsx)("br",{})]})})):Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){e.state.config.config.channels[c].streamUrl=t,e.save().then()}},children:t.length>0?t[0]:""}):Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){e.state.config.config.channels[c].streamUrl=t,e.save().then()}},children:t}):Object(n.jsx)("a",{})}},{title:"Transport",dataIndex:"transport",key:"transport",render:function(t,a,c){return Object(n.jsx)("div",{children:Object(n.jsxs)(b.a,{defaultValue:t,style:{width:120},onChange:function(t){console.log("selected ".concat(t));var a=Object(l.a)({},e.state.config);a.config.channels[c].transport=t,e.setState({config:a}),e.save().then()},children:[Object(n.jsx)(I,{value:"udp",children:"UDP"}),Object(n.jsx)(I,{value:"tcp",children:"TCP"})]})})}},{title:"RTSP FFmpeg parameters",dataIndex:"ffmpegPre",key:"ffmpegPre",render:function(t,a,c){return Object(n.jsx)("div",{children:Object(n.jsxs)("div",{children:[e.state.config.config.channels[c].ffmpegPre?Object.entries(e.state.config.config.channels[c].ffmpegPre).map((function(t){var a=t[0],s=t[1];return Object(n.jsxs)("div",{children:[Object(n.jsx)(v.a.Text,{disabled:!0,children:a}),Object(n.jsx)(v.a.Text,{disabled:!0,children:":"}),Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){var n=Object(l.a)({},e.state.config);n.config.channels[c].ffmpegPre||(n.config.channels[c].ffmpegPre={}),n.config.channels[c].ffmpegPre[a]=t,e.save().then(),e.setState({config:n})}},children:s}),Object(n.jsx)(O.a,{size:"small",type:"danger",className:"smallButton",onClick:function(){var t=Object(l.a)({},e.state.config);t.config.channels[c].ffmpegPre||(t.config.channels[c].ffmpegPre={}),delete t.config.channels[c].ffmpegPre[a],e.setState({config:t}),e.save().then()},children:"-"})]})})):Object(n.jsx)("div",{}),Object(n.jsxs)("div",{children:[Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){var a=Object(l.a)({},e.state.ffmpegPre);a.key=t,a.itemKey=c,e.setState({ffmpegPre:a})}},children:e.state.ffmpegPre&&e.state.ffmpegPre.itemKey===c?e.state.ffmpegPre.key:""}),Object(n.jsx)(v.a.Text,{disabled:!0,children:":"}),Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){var a=Object(l.a)({},e.state.ffmpegPre);a.value=t,a.valueItem=c,e.setState({ffmpegPre:a})}},children:e.state.ffmpegPre&&e.state.ffmpegPre.valueItem===c?e.state.ffmpegPre.value:""}),e.state.ffmpegPre.valueItem===c&&e.state.ffmpegPre.itemKey===c?Object(n.jsx)(O.a,{onClick:function(){var t=Object(l.a)({},e.state.ffmpegPre),a=Object(l.a)({},e.state.config);a.config.channels[c].ffmpegPre||(a.config.channels[c].ffmpegPre={}),a.config.channels[c].ffmpegPre[t.key]=t.value,e.setState({config:a}),e.save().then((function(){e.setState({ffmpegPre:{}})}))},children:"Add"}):Object(n.jsx)(O.a,{disabled:!0,children:"Add"})]})]})})}},{title:"Encode FFmpeg parameters",dataIndex:"ffmpeg",key:"ffmpeg",render:function(t,a,c){var s=Array.isArray(e.state.config.config.channels[c].streamUrl)?e.state.config.config.channels[c].streamUrl.length:1;return Object(n.jsxs)("div",{children:[Object(n.jsx)(v.a.Text,{disabled:!0,children:"-vf"}),Object(n.jsx)(v.a.Text,{disabled:!0,children:":"}),Object(n.jsx)(v.a.Text,{disabled:!0,children:"scale=".concat(e.state.status.width/s,":").concat(e.state.status.height/s)}),Object(n.jsx)("br",{}),Object(n.jsxs)("div",{children:[e.state.config.config.channels[c].ffmpeg?Object.entries(e.state.config.config.channels[c].ffmpeg).map((function(t){var a=t[0],s=t[1];return Object(n.jsxs)("div",{children:[Object(n.jsx)(v.a.Text,{disabled:!0,children:a}),Object(n.jsx)(v.a.Text,{disabled:!0,children:":"}),Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){var n=Object(l.a)({},e.state.config);n.config.channels[c].ffmpeg||(n.config.channels[c].ffmpeg={}),n.config.channels[c].ffmpeg[a]=t,e.save().then(),e.setState({config:n})}},children:s}),Object(n.jsx)(O.a,{size:"small",type:"danger",className:"smallButton",onClick:function(){var t=Object(l.a)({},e.state.config);t.config.channels[c].ffmpeg||(t.config.channels[c].ffmpeg={}),delete t.config.channels[c].ffmpeg[a],e.save().then(),e.setState({config:t})},children:"-"})]})})):Object(n.jsx)("div",{}),Object(n.jsxs)("div",{children:[Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){var a=Object(l.a)({},e.state.ffmpeg);a.key=t,a.itemKey=c,e.setState({ffmpeg:a})}},children:e.state.ffmpeg&&e.state.ffmpeg.itemKey===c?e.state.ffmpeg.key:""}),Object(n.jsx)(v.a.Text,{disabled:!0,children:":"}),Object(n.jsx)(v.a.Text,{editable:{onChange:function(t){var a=Object(l.a)({},e.state.ffmpeg);a.value=t,a.valueItem=c,e.setState({ffmpeg:a})}},children:e.state.ffmpeg&&e.state.ffmpeg.valueItem===c?e.state.ffmpeg.value:""}),e.state.ffmpeg.valueItem===c&&e.state.ffmpeg.itemKey===c?Object(n.jsx)(O.a,{onClick:function(){var t=Object(l.a)({},e.state.ffmpeg),a=Object(l.a)({},e.state.config);a.config.channels[c].ffmpeg||(a.config.channels[c].ffmpeg={}),a.config.channels[c].ffmpeg[t.key]=t.value,e.setState({config:a}),e.save().then((function(){e.setState({ffmpeg:{}})}))},children:"Add"}):Object(n.jsx)(O.a,{disabled:!0,children:"Add"})]})]})]})}},{title:"",dataIndex:"actions",key:"actions",render:function(t,a,c){return Object(n.jsxs)("div",{children:[0===c?Object(n.jsx)(O.a,{size:"small",className:"smallButton",disabled:!0,children:"UP"}):Object(n.jsx)(O.a,{size:"small",className:"smallButton",onClick:function(){var t=Object(l.a)({},e.state.config),a=t.config.channels[c];t.config.channels[c]=t.config.channels[c-1],t.config.channels[c-1]=a;var n=Object(l.a)({},e.state.status);n.currentChannel===c&&(n.currentChannel-=1),e.setState({config:t,status:n}),e.save().then((function(){e.saveActiveChannel().then()}))},children:"UP"}),c===e.state.config.config.channels.length-1?Object(n.jsx)(O.a,{size:"small",className:"smallButton",disabled:!0,children:"DOWN"}):Object(n.jsx)(O.a,{size:"small",className:"smallButton",onClick:function(){var t=Object(l.a)({},e.state.config),a=t.config.channels[c];t.config.channels[c]=t.config.channels[c+1],t.config.channels[c+1]=a;var n=Object(l.a)({},e.state.status);n.currentChannel===c&&(n.currentChannel+=1),e.setState({config:t,status:n}),e.save().then((function(){e.saveActiveChannel().then()}))},children:"DOWN"}),Object(n.jsx)(O.a,{size:"small",type:"danger",className:"smallButton",onClick:function(){var t=Object(l.a)({},e.state.config);t.config.channels=t.config.channels.filter((function(e,t){return t!==c})),e.setState({config:t}),e.save().then()},children:"Delete"})]})}}]}},{key:"cameraDatasource",value:function(e){var t=this,a=[];return e.channels&&e.channels.forEach((function(n,c){a.push({status:c===t.state.status.currentChannel,camera:c,transport:n.transport||e.transport||"udp",mode:Array.isArray(n.streamUrl)&&n.streamUrl.length>1?4:1,rtsp:n.streamUrl,ffmpeg:n.ffmpeg,ffmpegPre:n.ffmpegPre})})),a}},{key:"commonDatasource",value:function(e){return[{key:"1",name:"Default Transport",value:e.transport},{key:"2",name:"Default RTSP FFmpeg parameters",value:e.ffmpegPre},{key:"3",name:"Default Encode ffmpeg Parameters",value:e.ffmpeg},{key:"4",name:"Kill all ffmpeg during restart",value:e.killAll}]}}]),Object(u.a)(a,[{key:"componentDidMount",value:function(){var e=Object(d.a)(f.a.mark((function e(){var t,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.prev=1,e.next=4,w("/admin/config/get","GET");case 4:return t=e.sent,e.next=7,w("/admin/status/get","GET");case 7:a=e.sent,this.setState({config:JSON.parse(t)}),this.setState({status:JSON.parse(a)}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),this.setState({error:e.t0.message});case 15:return e.prev=15,this.setState({loading:!1}),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[1,12,15,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"handleMainTransportChange",value:function(e){console.log("selected ".concat(e));var t=Object(l.a)({},this.state.config);t.config.transport=e,this.setState({config:t}),this.save().then()}},{key:"handleCameraChange",value:function(e){console.log("selected ".concat(e));var t=Object(l.a)({},this.state.newCamera);t.mode=e,this.setState({newCamera:t})}},{key:"render",value:function(){var e,t=this.state,a=t.loading,c=t.config,s=t.error;if(a)e=Object(n.jsx)(p.a,{indicator:Object(n.jsx)(S.a,{style:{fontSize:128},spin:!0})});else if(c&&c.config){var r=c.config,i=this.commonDatasource(r),l=this.cameraDatasource(r);e=Object(n.jsxs)("div",{children:[s?Object(n.jsx)(C.a,{message:s,type:"error"}):null,Object(n.jsx)(v.a.Text,{children:"Common Settings"}),Object(n.jsx)("br",{}),Object(n.jsxs)(v.a.Text,{code:!0,children:["File: ",r.file]}),Object(n.jsx)("br",{}),Object(n.jsx)(y.a,{columns:this.commonColumns(),dataSource:i,scroll:{x:"max-content"},pagination:{total:i.length,pageSize:i.length,hideOnSinglePage:!0}}),Object(n.jsx)("br",{}),Object(n.jsx)("br",{}),Object(n.jsx)(v.a.Text,{children:"Add new Camera"}),Object(n.jsx)("br",{}),Object(n.jsx)(y.a,{columns:this.addColumns(),scroll:{x:"max-content"},dataSource:this.addDatasource(),pagination:{hideOnSinglePage:!0}}),Object(n.jsx)(v.a.Text,{children:"Camera Settings"}),Object(n.jsx)("br",{}),Object(n.jsx)(y.a,{columns:this.cameraColumns(),scroll:{x:"max-content"},dataSource:l,pagination:{total:l.length,pageSize:l.length,hideOnSinglePage:!0}})]})}else e=Object(n.jsx)(C.a,{message:"config is empty",type:"error"});return e}}]),a}(s.a.Component);a(338);var N=function(){return Object(n.jsx)("div",{className:"App",children:Object(n.jsx)("header",{className:"App-header",children:Object(n.jsx)(D,{})})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(Object(n.jsx)(s.a.StrictMode,{children:Object(n.jsx)(N,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[339,1,2]]]);
//# sourceMappingURL=main.b0399777.chunk.js.map