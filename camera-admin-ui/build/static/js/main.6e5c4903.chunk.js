(this["webpackJsonpcamera-admin-ui"]=this["webpackJsonpcamera-admin-ui"]||[]).push([[0],{173:function(e,a,t){e.exports=t(334)},178:function(e,a,t){},180:function(e,a,t){},333:function(e,a,t){},334:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),c=t(21),s=t.n(c),l=(t(178),t(179),t(23)),i=t(44),o=t.n(i),m=t(66),f=t(144),u=t(47),g=t(115),d=t(166),h=t(170),v=(t(180),t(80)),p=t(338),E=t(68),b=t(153),C=t(340),y=t(337),S=t(339),O=t(181);function k(e){return x.apply(this,arguments)}function x(){return(x=Object(m.a)(o.a.mark((function e(a){var t,n,r,c,s=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>1&&void 0!==s[1]?s[1]:"GET",n=s.length>2?s[2]:void 0,r="".concat("").concat(a),e.next=5,O({url:r,method:t,headers:n,transformResponse:function(e){return e},withCredentials:!0,timeout:4900});case 5:return c=e.sent,e.abrupt("return",c.data);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return j.apply(this,arguments)}function j(){return(j=Object(m.a)(o.a.mark((function e(a){var t,n,r,c,s=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>1&&void 0!==s[1]?s[1]:"POST",n=s.length>2?s[2]:void 0,r=s.length>3?s[3]:void 0,e.next=5,O({url:"".concat("").concat(a),method:t,data:n,transformResponse:function(e){return e},headers:r||{"Content-Type":"application/json"},withCredentials:!0,timeout:4900});case 5:return c=e.sent,e.abrupt("return",c.data);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=v.a.Option,P=function(e){Object(h.a)(t,e);var a=Object(d.a)(t);function t(e){var n;return Object(f.a)(this,t),(n=a.call(this,e)).state={loading:!0,config:null,error:null,status:null,newCamera:{},ffmpeg:{},ffmpegPre:{}},n.save=n.save.bind(Object(u.a)(n)),n.handleMainTransportChange=n.handleMainTransportChange.bind(Object(u.a)(n)),n.handleCameraChange=n.handleCameraChange.bind(Object(u.a)(n)),n.cameraDatasource=n.cameraDatasource.bind(Object(u.a)(n)),n.cameraColumns=n.cameraColumns.bind(Object(u.a)(n)),n.saveActiveChannel=n.saveActiveChannel.bind(Object(u.a)(n)),n.addDatasource=n.addDatasource.bind(Object(u.a)(n)),n.commonColumns=n.commonColumns.bind(Object(u.a)(n)),n}return Object(g.a)(t,[{key:"save",value:function(){var e=Object(m.a)(o.a.mark((function e(){var a,t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.prev=1,a=JSON.stringify(this.state.config.config),e.next=5,w("/admin/config/save","POST",a);case 5:t=e.sent,this.setState({config:JSON.parse(t)}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),this.setState({error:e.t0.message});case 12:return e.prev=12,this.setState({loading:!1}),e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[1,9,12,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"saveActiveChannel",value:function(){var e=Object(m.a)(o.a.mark((function e(){var a,t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.prev=1,a=JSON.stringify(this.state.status),e.next=5,w("/admin/status/save","POST",a);case 5:t=e.sent,this.setState({status:JSON.parse(t)}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),this.setState({error:e.t0.message});case 12:return e.prev=12,this.setState({loading:!1}),e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[1,9,12,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"commonColumns",value:function(){var e=this;return[{title:"Parameter Name",dataIndex:"name",key:"name",render:function(e){return r.a.createElement("a",null,e)}},{title:"Parameter Value",dataIndex:"value",key:"value",render:function(a,t){if("1"===t.key)return r.a.createElement("div",null,r.a.createElement(v.a,{defaultValue:a,style:{width:120},onChange:e.handleMainTransportChange},r.a.createElement(T,{value:"udp"},"UDP"),r.a.createElement(T,{value:"tcp"},"TCP")));if("2"===t.key||"3"===t.key){var n="3"===t.key?"ffmpeg":"ffmpegPre";return r.a.createElement("div",null,r.a.createElement("div",null,e.state.config.config[n]?Object.entries(e.state.config.config[n]).map((function(a,t){var c=a[0],s=a[1];return r.a.createElement("div",null,r.a.createElement(p.a.Text,{disabled:!0},c),r.a.createElement(p.a.Text,{disabled:!0},":"),r.a.createElement(p.a.Text,{editable:{onChange:function(a){var t=Object(l.a)({},e.state.config);t.config[n]||(t.config[n]={}),t.config[n][c]=a,e.save().then(),e.setState({config:t})}}},s),r.a.createElement(E.a,{size:"small",type:"danger",className:"smallButton",onClick:function(){var a=Object(l.a)({},e.state.config);a.config[n]||(a.config[n]={}),delete a.config[n][c],e.setState({config:a}),e.save().then()}},"-"))})):r.a.createElement("div",null),r.a.createElement("div",null,r.a.createElement(p.a.Text,{editable:{onChange:function(a){var t=Object(l.a)({},e.state[n]);t.key=a,t.itemKey=-1;var r={};r[n]=t,e.setState(r)}}},e.state[n]&&-1===e.state[n].itemKey?e.state[n].key:""),r.a.createElement(p.a.Text,{disabled:!0},":"),r.a.createElement(p.a.Text,{editable:{onChange:function(a){var t=Object(l.a)({},e.state[n]);t.value=a,t.valueItem=-1;var r={};r[n]=t,e.setState(r)}}},e.state[n]&&-1===e.state[n].valueItem?e.state[n].value:""),-1===e.state[n].valueItem&&-1===e.state[n].itemKey?r.a.createElement(E.a,{onClick:function(){var a=Object(l.a)({},e.state[n]),t=Object(l.a)({},e.state.config);t.config[n]||(t.config[n]={}),t.config[n][a.key]=a.value,e.setState({config:t}),e.save().then((function(){var a={};a[n]={},e.setState(a)}))}},"Add"):r.a.createElement(E.a,{disabled:!0},"Add"))))}return r.a.createElement("a",null,a)}}]}},{key:"addColumns",value:function(){var e=this;return[{title:"Mode",dataIndex:"mode",key:"mode",render:function(a){return r.a.createElement("div",null,r.a.createElement(v.a,{defaultValue:a,style:{width:120},onChange:e.handleCameraChange},r.a.createElement(T,{value:"single"},"1 Camera"),r.a.createElement(T,{value:"multi"},"4 Cameras")))}},{title:"rtsp Streams",dataIndex:"rtsp",key:"rtsp",render:function(){return"multi"===e.state.newCamera.mode?r.a.createElement("div",null,r.a.createElement(p.a.Text,{editable:{onChange:function(a){var t=Object(l.a)({},e.state.newCamera);t.camera1=a,e.setState({newCamera:t})}}},e.state.newCamera.camera1||""),r.a.createElement("br",null),r.a.createElement(p.a.Text,{editable:{onChange:function(a){var t=Object(l.a)({},e.state.newCamera);t.camera2=a,e.setState({newCamera:t})}}},e.state.newCamera.camera2||""),r.a.createElement("br",null),r.a.createElement(p.a.Text,{editable:{onChange:function(a){var t=Object(l.a)({},e.state.newCamera);t.camera3=a,e.setState({newCamera:t})}}},e.state.newCamera.camera3||""),r.a.createElement("br",null),r.a.createElement(p.a.Text,{editable:{onChange:function(a){var t=Object(l.a)({},e.state.newCamera);t.camera4=a,e.setState({newCamera:t})}}},e.state.newCamera.camera4||""),r.a.createElement("br",null)):r.a.createElement(p.a.Text,{editable:{onChange:function(a){var t=Object(l.a)({},e.state.newCamera);t.camera1=a,e.setState({newCamera:t})}}},e.state.newCamera.camera1||"")}},{title:"",dataIndex:"save",key:"save",render:function(){var a=e.state.newCamera.mode||"single",t=!1;return"single"!==a||e.state.newCamera.camera1||(t=!0),"multi"!==a||e.state.newCamera.camera1&&e.state.newCamera.camera2&&e.state.newCamera.camera3&&e.state.newCamera.camera4||(t=!0),t?r.a.createElement("div",null,r.a.createElement(E.a,{disabled:!0},"Save")):r.a.createElement("div",null,r.a.createElement(E.a,{onClick:function(){var t,n=Object(l.a)({},e.state.config);t="single"===a?{streamUrl:e.state.newCamera.camera1}:{streamUrl:[e.state.newCamera.camera1,e.state.newCamera.camera2,e.state.newCamera.camera3,e.state.newCamera.camera4]},n.config.channels.push(t),e.setState({config:n}),e.save().then((function(){e.setState({newCamera:{}})}))}},"Save"))}}]}},{key:"addDatasource",value:function(){var e=this.state.newCamera;return[{mode:e.mode||"single",rtsp:[e.camera1,e.camera2,e.camera3,e.camera4]}]}},{key:"cameraColumns",value:function(){var e=this;return[{title:"Status",dataIndex:"status",key:"status",render:function(a,t,n){return a?r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"/camera.html"},"Current"):r.a.createElement(E.a,{onClick:function(){e.state.status.currentChannel=n,e.saveActiveChannel().then()}},"Activate")}},{title:"Camera",dataIndex:"camera",key:"camera",render:function(e){return r.a.createElement("a",null,e)}},{title:"Camera Mode",dataIndex:"mode",key:"mode",render:function(e){return r.a.createElement("a",null,1===e?"1 Camera":"4 Cameras")}},{title:"rtsp Streams",dataIndex:"rtsp",key:"rtsp",render:function(a,t,n){return a?Array.isArray(a)?a.length>1?a.map((function(a,t){return r.a.createElement("div",null,r.a.createElement(p.a.Text,{editable:{onChange:function(a){e.state.config.config.channels[n].streamUrl[t]=a,e.save().then()}}},a),r.a.createElement("br",null))})):r.a.createElement(p.a.Text,{editable:{onChange:function(a){e.state.config.config.channels[n].streamUrl=a,e.save().then()}}},a.length>0?a[0]:""):r.a.createElement(p.a.Text,{editable:{onChange:function(a){e.state.config.config.channels[n].streamUrl=a,e.save().then()}}},a):r.a.createElement("a",null)}},{title:"Transport",dataIndex:"transport",key:"transport",render:function(a,t,n){return r.a.createElement("div",null,r.a.createElement(v.a,{defaultValue:a,style:{width:120},onChange:function(a){console.log("selected ".concat(a));var t=Object(l.a)({},e.state.config);t.config.channels[n].transport=a,e.setState({config:t}),e.save().then()}},r.a.createElement(T,{value:"udp"},"UDP"),r.a.createElement(T,{value:"tcp"},"TCP")))}},{title:"RTSP FFmpeg parameters",dataIndex:"ffmpegPre",key:"ffmpegPre",render:function(a,t,n){return r.a.createElement("div",null,r.a.createElement("div",null,e.state.config.config.channels[n].ffmpegPre?Object.entries(e.state.config.config.channels[n].ffmpegPre).map((function(a){var t=a[0],c=a[1];return r.a.createElement("div",null,r.a.createElement(p.a.Text,{disabled:!0},t),r.a.createElement(p.a.Text,{disabled:!0},":"),r.a.createElement(p.a.Text,{editable:{onChange:function(a){var r=Object(l.a)({},e.state.config);r.config.channels[n].ffmpegPre||(r.config.channels[n].ffmpegPre={}),r.config.channels[n].ffmpegPre[t]=a,e.save().then(),e.setState({config:r})}}},c),r.a.createElement(E.a,{size:"small",type:"danger",className:"smallButton",onClick:function(){var a=Object(l.a)({},e.state.config);a.config.channels[n].ffmpegPre||(a.config.channels[n].ffmpegPre={}),delete a.config.channels[n].ffmpegPre[t],e.setState({config:a}),e.save().then()}},"-"))})):r.a.createElement("div",null),r.a.createElement("div",null,r.a.createElement(p.a.Text,{editable:{onChange:function(a){var t=Object(l.a)({},e.state.ffmpegPre);t.key=a,t.itemKey=n,e.setState({ffmpegPre:t})}}},e.state.ffmpegPre&&e.state.ffmpegPre.itemKey===n?e.state.ffmpegPre.key:""),r.a.createElement(p.a.Text,{disabled:!0},":"),r.a.createElement(p.a.Text,{editable:{onChange:function(a){var t=Object(l.a)({},e.state.ffmpegPre);t.value=a,t.valueItem=n,e.setState({ffmpegPre:t})}}},e.state.ffmpegPre&&e.state.ffmpegPre.valueItem===n?e.state.ffmpegPre.value:""),e.state.ffmpegPre.valueItem===n&&e.state.ffmpegPre.itemKey===n?r.a.createElement(E.a,{onClick:function(){var a=Object(l.a)({},e.state.ffmpegPre),t=Object(l.a)({},e.state.config);t.config.channels[n].ffmpegPre||(t.config.channels[n].ffmpegPre={}),t.config.channels[n].ffmpegPre[a.key]=a.value,e.setState({config:t}),e.save().then((function(){e.setState({ffmpegPre:{}})}))}},"Add"):r.a.createElement(E.a,{disabled:!0},"Add"))))}},{title:"Encode FFmpeg parameters",dataIndex:"ffmpeg",key:"ffmpeg",render:function(a,t,n){var c=Array.isArray(e.state.config.config.channels[n].streamUrl)?e.state.config.config.channels[n].streamUrl.length:1;return r.a.createElement("div",null,r.a.createElement(p.a.Text,{disabled:!0},"-vf"),r.a.createElement(p.a.Text,{disabled:!0},":"),r.a.createElement(p.a.Text,{disabled:!0},"scale=".concat(e.state.status.width/c,":").concat(e.state.status.height/c)),r.a.createElement("br",null),r.a.createElement("div",null,e.state.config.config.channels[n].ffmpeg?Object.entries(e.state.config.config.channels[n].ffmpeg).map((function(a){var t=a[0],c=a[1];return r.a.createElement("div",null,r.a.createElement(p.a.Text,{disabled:!0},t),r.a.createElement(p.a.Text,{disabled:!0},":"),r.a.createElement(p.a.Text,{editable:{onChange:function(a){var r=Object(l.a)({},e.state.config);r.config.channels[n].ffmpeg||(r.config.channels[n].ffmpeg={}),r.config.channels[n].ffmpeg[t]=a,e.save().then(),e.setState({config:r})}}},c),r.a.createElement(E.a,{size:"small",type:"danger",className:"smallButton",onClick:function(){var a=Object(l.a)({},e.state.config);a.config.channels[n].ffmpeg||(a.config.channels[n].ffmpeg={}),delete a.config.channels[n].ffmpeg[t],e.save().then(),e.setState({config:a})}},"-"))})):r.a.createElement("div",null),r.a.createElement("div",null,r.a.createElement(p.a.Text,{editable:{onChange:function(a){var t=Object(l.a)({},e.state.ffmpeg);t.key=a,t.itemKey=n,e.setState({ffmpeg:t})}}},e.state.ffmpeg&&e.state.ffmpeg.itemKey===n?e.state.ffmpeg.key:""),r.a.createElement(p.a.Text,{disabled:!0},":"),r.a.createElement(p.a.Text,{editable:{onChange:function(a){var t=Object(l.a)({},e.state.ffmpeg);t.value=a,t.valueItem=n,e.setState({ffmpeg:t})}}},e.state.ffmpeg&&e.state.ffmpeg.valueItem===n?e.state.ffmpeg.value:""),e.state.ffmpeg.valueItem===n&&e.state.ffmpeg.itemKey===n?r.a.createElement(E.a,{onClick:function(){var a=Object(l.a)({},e.state.ffmpeg),t=Object(l.a)({},e.state.config);t.config.channels[n].ffmpeg||(t.config.channels[n].ffmpeg={}),t.config.channels[n].ffmpeg[a.key]=a.value,e.setState({config:t}),e.save().then((function(){e.setState({ffmpeg:{}})}))}},"Add"):r.a.createElement(E.a,{disabled:!0},"Add"))))}},{title:"",dataIndex:"actions",key:"actions",render:function(a,t,n){return r.a.createElement("div",null,0===n?r.a.createElement(E.a,{size:"small",className:"smallButton",disabled:!0},"UP"):r.a.createElement(E.a,{size:"small",className:"smallButton",onClick:function(){var a=Object(l.a)({},e.state.config),t=a.config.channels[n];a.config.channels[n]=a.config.channels[n-1],a.config.channels[n-1]=t;var r=Object(l.a)({},e.state.status);r.currentChannel===n&&(r.currentChannel=r.currentChannel-1),e.setState({config:a,status:r}),e.save().then((function(){e.saveActiveChannel().then()}))}},"UP"),n===e.state.config.config.channels.length-1?r.a.createElement(E.a,{size:"small",className:"smallButton",disabled:!0},"DOWN"):r.a.createElement(E.a,{size:"small",className:"smallButton",onClick:function(){var a=Object(l.a)({},e.state.config),t=a.config.channels[n];a.config.channels[n]=a.config.channels[n+1],a.config.channels[n+1]=t;var r=Object(l.a)({},e.state.status);r.currentChannel===n&&(r.currentChannel=r.currentChannel+1),e.setState({config:a,status:r}),e.save().then((function(){e.saveActiveChannel().then()}))}},"DOWN"),r.a.createElement(E.a,{size:"small",type:"danger",className:"smallButton",onClick:function(){var a=Object(l.a)({},e.state.config);a.config.channels=a.config.channels.filter((function(e,a){return a!==n})),e.setState({config:a}),e.save().then()}},"Delete"))}}]}},{key:"cameraDatasource",value:function(e){var a=this,t=[];return e.channels&&e.channels.forEach((function(n,r){t.push({status:r===a.state.status.currentChannel,camera:r,transport:n.transport||e.transport||"udp",mode:Array.isArray(n.streamUrl)&&n.streamUrl.length>1?4:1,rtsp:n.streamUrl,ffmpeg:n.ffmpeg,ffmpegPre:n.ffmpegPre})})),t}},{key:"commonDatasource",value:function(e){return[{key:"1",name:"Default Transport",value:e.transport},{key:"2",name:"Default RTSP FFmpeg parameters",value:e.ffmpegPre},{key:"3",name:"Default Encode ffmpeg Parameters",value:e.ffmpeg}]}}]),Object(g.a)(t,[{key:"componentDidMount",value:function(){var e=Object(m.a)(o.a.mark((function e(){var a,t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.prev=1,e.next=4,k("/admin/config/get","GET");case 4:return a=e.sent,e.next=7,k("/admin/status/get","GET");case 7:t=e.sent,this.setState({config:JSON.parse(a)}),this.setState({status:JSON.parse(t)}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),this.setState({error:e.t0.message});case 15:return e.prev=15,this.setState({loading:!1}),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[1,12,15,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"handleMainTransportChange",value:function(e){console.log("selected ".concat(e));var a=Object(l.a)({},this.state.config);a.config.transport=e,this.setState({config:a}),this.save().then()}},{key:"handleCameraChange",value:function(e){console.log("selected ".concat(e));var a=Object(l.a)({},this.state.newCamera);a.mode=e,this.setState({newCamera:a})}},{key:"render",value:function(){var e,a=this.state,t=a.loading,n=a.config,c=a.error;if(t)e=r.a.createElement(b.a,{indicator:r.a.createElement(S.a,{style:{fontSize:128},spin:!0})});else if(n&&n.config){var s=n.config,l=this.commonDatasource(s),i=this.cameraDatasource(s);e=r.a.createElement("div",null,c?r.a.createElement(C.a,{message:c,type:"error"}):null,r.a.createElement(p.a.Text,null,"Common Settings"),r.a.createElement("br",null),r.a.createElement(p.a.Text,{code:!0},"File: ",s.file),r.a.createElement("br",null),r.a.createElement(y.a,{columns:this.commonColumns(),dataSource:l,pagination:{total:l.length,pageSize:l.length,hideOnSinglePage:!0}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(p.a.Text,null,"Add new Camera"),r.a.createElement("br",null),r.a.createElement(y.a,{columns:this.addColumns(),dataSource:this.addDatasource(),pagination:{hideOnSinglePage:!0}}),r.a.createElement(p.a.Text,null,"Camera Settings"),r.a.createElement("br",null),r.a.createElement(y.a,{columns:this.cameraColumns(),dataSource:i,pagination:{total:i.length,pageSize:i.length,hideOnSinglePage:!0}}))}else e=r.a.createElement(C.a,{message:"config is empty",type:"error"});return e}}]),t}(r.a.Component);t(333);var I=function(){return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement(P,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(I,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[173,1,2]]]);
//# sourceMappingURL=main.6e5c4903.chunk.js.map