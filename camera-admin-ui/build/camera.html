<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="Tizen basic template generated by Tizen Web IDE"/>

    <title>Tizen Web IDE - Tizen - Samsung Tizen TV basic Application</title>

    <script>
        var serverInfo = {
            ip: window.location.hostname || 'localhost', // <-- Server IP
            port: window.location.port === '3000' ? '3004' : window.location.port,
        };

        var reload = (callback, error) => {
            var xhr = new XMLHttpRequest();
            const url = 'http://' + serverInfo.ip + ':' + serverInfo.port + '/reload';
            xhr.open("GET", url, true);
            xhr.onreadystatechange = function () {        // ready state event, will be executed once the server send back the data
                if (xhr.readyState === xhr.DONE) {
                    if (xhr.status === 200) {
                        callback()
                    } else {
                        error('Error '+xhr.status,new Error(xhr.status))
                    }
                }
            };
            xhr.onerror = function (e) {
                error(xhr.statusText,e);
                console.error(xhr.statusText);
            };
            xhr.send(null);
        }

        var getInfo = (callback, error) => {
            var xhr = new XMLHttpRequest();
            const url = 'http://' + serverInfo.ip + ':' + serverInfo.port + '/info';
            xhr.open("GET", url, true);
            xhr.onreadystatechange = function () {        // ready state event, will be executed once the server send back the data
                if (xhr.readyState === xhr.DONE) {
                    if (xhr.status === 200) {
                        callback(JSON.parse(xhr.responseText))
                    } else {
                        error('Error '+xhr.status,new Error(xhr.status))
                    }
                }
            };
            xhr.onerror = function (e) {
                error(xhr.statusText,e);
                console.error(xhr.statusText);
            };
            xhr.send(null);
        }
    </script>
    <style>

    </style>
</head>

<body>
<table BGCOLOR="#000000" BORDER=0 CELLSPACING=0 CELLPADDING=0>
    <tr>
        <td>
            <canvas id="canvas1"></canvas>
        </td>
        <td>
            <canvas id="canvas3"></canvas>
        </td>
    </tr>
    <tr>
        <td>
            <canvas id="canvas2"/>
        </td>
        <td>
            <canvas id="canvas4"/>
        </td>
    </tr>
</table>
</body>
<script type="text/javascript" src="jsmpeg.min.js"></script>
<script type="text/javascript">
    reload(()=>getInfo((resp) => {
        var mode = resp.mode;
        if (mode > 0) {
            const url1 = 'ws://' + serverInfo.ip + ':9999';
            new JSMpeg.Player(url1, {
                canvas: document.getElementById('canvas1') // Canvas should be a canvas DOM element
            })
        }
        if (mode > 1) {
            const url2 = 'ws://' + serverInfo.ip + ':10000';
            new JSMpeg.Player(url2, {
                canvas: document.getElementById('canvas2') // Canvas should be a canvas DOM element
            })
        }
        if (mode > 2) {
            const url3 = 'ws://' + serverInfo.ip + ':10001';
            new JSMpeg.Player(url3, {
                canvas: document.getElementById('canvas3') // Canvas should be a canvas DOM element
            })
        }
        if (mode > 3) {
            const url4 = 'ws://' + serverInfo.ip + ':10002';
            new JSMpeg.Player(url4, {
                canvas: document.getElementById('canvas4') // Canvas should be a canvas DOM element
            })
        }
    }));
</script>
</html>
